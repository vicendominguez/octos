agent:
  cmd: "kiro-cli"
  args: ["chat", "--no-interactive", "--trust-all-tools"]

context:
  role: "Senior Go developer specialized in modern CLIs"
  rules:
    - "Idiomatic Go code"
    - "Simple and composable CLIs"
    - "Use Charm libraries when appropriate"
    - "Prioritize simplicity and maintainability"
    - "Document technical decisions"
  files:
    idea: "IDEA.md"
    insights: "GO_INSIGHTS.md"

steps:
  - name: read-idea
    prompt: |
      Read "{{context.files.idea}}".
      Extract functional and technical requirements.
      Return concise JSON format.
    save_to: idea-requirements.txt

  - name: check-insights
    prompt: |
      Does the file "{{context.files.insights}}" exist?
      Answer ONLY "YES" or "NO".
    save_to: insights-status.txt

  - name: read-insights
    when: "{{check-insights.output}} contains YES"
    prompt: |
      Read "{{context.files.insights}}".
      Summarize in 5 bullets: useful patterns, errors to avoid, technical decisions.
    save_to: insights-summary.txt

  - name: plan-mvp
    load_from: idea-requirements.txt
    prompt: |
      Based on: {{artifact.idea-requirements}}
      
      Design MVP plan with tasks, dependencies, and complexity estimates.
    save_to: mvp-plan.txt

  - name: resolve-deps
    load_from: mvp-plan.txt
    prompt: |
      Plan: {{artifact.mvp-plan}}
      
      Determine necessary Charm libraries (stable versions).
      Generate go.mod snippet.
    save_to: dependencies.txt

  - name: scaffold
    load_from: mvp-plan.txt
    prompt: |
      Plan: {{artifact.mvp-plan}}
      
      Generate Go project structure.
      Show file tree.
    save_to: scaffold.txt

  - name: implement-basic
    when: "{{check-insights.output}} contains NO"
    load_from: scaffold.txt
    prompt: |
      Structure: {{artifact.scaffold}}
      
      Implement complete CLI in Go.
      Rules: {{context.rules}}

  - name: implement-with-insights
    when: "{{check-insights.output}} contains YES"
    load_from: insights-summary.txt
    prompt: |
      Previous insights: {{artifact.insights-summary}}
      
      Implement CLI applying these insights.
      Rules: {{context.rules}}

  - name: tests
    prompt: "Write key unit tests for the implemented CLI"

  - name: verify
    prompt: |
      Provide commands to:
      - Compile the project
      - Run tests
      - Highlight common errors
    save_to: verification.txt

  - name: update-insights
    when: "{{verify.output}} contains go test"
    prompt: |
      Update "{{context.files.insights}}" adding:
      - New learnings from this implementation
      - Technical decisions made
      - Useful patterns discovered

  - name: finalize
    prompt: |
      Review the entire process.
      Ensure "{{context.files.idea}}" and "{{context.files.insights}}" are updated and complete.
      Document any important technical decisions in "{{context.files.insights}}".
